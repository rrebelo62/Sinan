<html>

<head>
    <title>Penrose</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .left_panel,
        .right_panel {
            margin: 2px;
            float: left;
            height: 97%;
            border-radius: 10px;
        }

        .left_panel {
            border: 1px solid #c04300;
            width: 200px;
        }

        .right_panel {
            border: 2px solid teal;
            width: calc(100% - 216px);
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .setting {
            margin-bottom: 30px;
            cursor: pointer;
        }

        .toolbox {
            width: 2.5em;
            height: 2em;
            border: solid 2px black;
            border-radius: 2px;
            position: absolute;
            left: calc(100% - 100px);
            top: 50;
            padding: 0;
            padding-top: 1em;
        }

        .grip {
            background-color: white;
            background-image: url("./ui/grip_bg.svg");
            position: absolute;
            cursor: move;
        }

        .left_menu {
            list-style: none;
        }

        #content {
            height: calc(97% - 3em);
            padding: 5px;
        }


        .draw_btn {
            float: right;
            font-size: larger;
            margin: 15px;
        }

        .color_button {
            display: inline-block;
            vertical-align: top;
            width: 3em;
            height: 1.5em;
            border: solid 1px black;
            border-radius: 5px;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="ui/nano.min.css" />
</head>

<body onload="init_color_picker()">
    <div class="row">
        <div class="left_panel">
            <form id="form_settings">
                <div class="setting">Filling pattern:
                    <div style="margin-left: 25px;">
                        <input type="radio" id="rhombus" name="pattern" value="rhombus" title="2 rhombi"
                            checked="checked"><svg xmlns="http://www.w3.org/2000/svg" viewBox="12 0 30 21" width="42"
                            height="23">
                            <path d="m 12.395017,10.474576 7.266,-9.99999973 7.265,9.99999973 -7.265,10 z"
                                fill="#ff8800" stroke="black" stroke-width="1" />
                            <path d="m 20,0.55932203 7.265,9.99999997 11.756,3.819 -7.266,-9.9999999 z" fill="#aaaaff"
                                stroke="black" stroke-width="1" />
                        </svg></input><br />
                        <input type="radio" id="kite_dart" name="pattern" title="kite and dart" value="kite_dart"><svg
                            width="42" height="23" viewBox="0 0 12 6">
                            <g stroke-width="0.3" stroke="black">
                                <path d="M6,0.17l-5.8,2.83l5.8,2.83l-2,-2.83z" fill="#ccf" />
                                <path d="M5.9,0.17l5.8,2.83l-5.68,2.8l-2,-2.83l2.14,-2.8" fill="#fa4" />
                            </g>
                        </svg></input>
                    </div>
                </div>
                <div class="setting">Iteractions:
                    <input type="number" id="iteractions" style="width: 3em;" min="0" max="8" value="4" />
                </div>
                <div class="setting" id="color_setting">
                    Color 1:
                    <div id="color1" class="color_button" style="background-color:#c04300;"></div>
                    <div style="margin-top: 5px;" id="color2_container">Color 2:
                        <div id="color2" class="color_button" style="background-color:#008D56;"></div>
                    </div>
                </div>
                <div class="setting">Starting shape:<br />
                    <div style="margin-left: 25px;">
                        <input type="radio" id="wheel" title="wheel" name="shape" value="wheel" checked="checked"><svg
                            xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet"
                            viewBox="10 0 400 400" width="24px" height="24px">
                            <polygon
                                points="390.211,261.803 390.211,138.196 317.557,38.196 200,0 82.442,38.196 9.788,138.196 9.788,261.803 82.442,361.803 200,400 317.557,361.803"
                                fill="#fa4" stroke="black" stroke-width="10" />
                        </svg></input><br />
                        <input type="radio" id="rhombus" title="rhombus" name="shape" value="rhombus"><svg width="35"
                            height="23" viewBox="0 0 8 8">
                            <path d="M0.17, 6L2,0.17L10,0.17L8,6Z" stroke-width="0.3" stroke="black" fill="#ccf" />
                        </svg></input>
                    </div>
                </div>
                <div class="setting">
                    <div id="color3_container">Edge:
                        <input type="color" id="color3" value="lightgray" class="color_button" />
                    </div>
                    <div style="position: relative; margin-top: 10px; margin-left: 15px;">
                        <svg viewBox="0 0 100 13" width="6em" style="position: absolute;top:0px;left:1.5em;">
                            <line x1="0" y1="0" x2="0" y2="12" stroke="black" stroke-width="1" />
                            <line x1="50" y1="0" x2="50" y2="12" stroke="black" stroke-width="1" />
                            <line x1="87" y1="0" x2="87" y2="12" stroke="black" stroke-width="1" />
                            <text x="0" y="12" style="font: 12px sans-serif;">0</text>
                            <text x="50" y="12" style="font: 12px sans-serif;">5</text>
                            <text x="87" y="12" style="font: 12px sans-serif;">10</text>
                        </svg>
                        <input type="range" id="width_edge" value="1" max="10" min="0"
                            style="width:9em; position: absolute;left: 2em;top:10px;" />
                    </div>
                </div>
                <div class=" setting"><button id="draw_btn" class="draw_btn">Draw</button>
                </div>
            </form>
        </div>
        <div class="right_panel">
            <div id="content" ondragover="allowDrop(event)">
            </div>
            <!--div class="toolbox" id="toolbox" draggable="true" ondragstart="dragstart(event)">
                <div class="grip" style="width: 100%; height: 1em; top: 0;"></div>
                <svg xmlns=" http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path
                        d="M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z" />
                </svg-->
        </div>
    </div>
    </div>
    <script>
        function init_color_picker() {
            document.getElementById("color3_container").innerHTML = 'Edge: <div id="color3" class="color_button" style="background-color:#aaa;"/>';
            var pickr_config = {
                el: '#color1',
                theme: 'nano',
                default: '#c04300',
                useAsButton: true,
                defaultRepresentation: 'HEX',
                swatches: [
                    //'rgb(244, 67, 54)',
                    'rgb(233, 30, 99)',
                    'rgb(156, 39, 176)',
                    //'rgb(103, 58, 183)',
                    'rgb(63, 81, 181)',
                    //'rgb(33, 150, 243)',
                    'rgb(3, 169, 244)',
                    //'rgb(0, 188, 212)'/*,
                    'rgb(0, 150, 136)',
                    'rgb(76, 175, 80)',
                    //'rgb(139, 195, 74)',
                    //'rgb(205, 220, 57)',
                    'rgb(255, 235, 59)'//,
                    //'rgb(255, 193, 7)'*/
                ],

                components: {
                    preview: true,
                    hue: true,
                    interaction: {
                        input: true,
                        clear: true,
                        save: true
                    }
                }
            };
            const save_color = function (element_id, color, instance) {
                const hexColor = '#' + color.toHEXA().join("");
                var el = document.getElementById(element_id);
                el.style.backgroundColor = hexColor;
                el.value = hexColor;
                instance.hide();
            }
            const pickr1 = Pickr.create(pickr_config);
            document.getElementById("color1").value = "#c04300";
            pickr1.on('save', save_color.bind(this, "color1"));
            pickr_config.el = "#color2";
            pickr_config.default = "#008D56";
            const pickr2 = Pickr.create(pickr_config);
            document.getElementById("color2").value = "#008D56";
            pickr2.on('save', save_color.bind(this, "color2"));
            pickr_config.el = "#color3";
            pickr_config.default = "#aaa";
            document.getElementById("color3").value = "#aaa";
            const pickr3 = Pickr.create(pickr_config);
            pickr3.on('save', save_color.bind(this, "color3"));
        }
        function dragstart(ev) {
            const box = ev.target;
            const shiftX = ev.clientX - ev.target.getBoundingClientRect().left;
            const shiftY = ev.clientY - ev.target.getBoundingClientRect().top;
            const content = document.getElementById("content");
            content.ondrop = drop;

            function drop(ev) {
                box.style.left = ev.clientX - shiftX;
                box.style.top = ev.clientY - shiftY;
                content.ondrop = undefined;
            }
        }
        function allowDrop(ev) {
            ev.preventDefault();
            return false;
        }
    </script>
    <script type="module">
        import init, { generate_svg } from './web/sirjohn.js';
        function draw(event) {
            console.log(event);
            event.preventDefault();
            const i = parseInt(document.getElementById("iteractions").value, 10);
            const c1 = document.getElementById("color1").value;
            const c2 = document.getElementById("color2").value;
            const c3 = document.getElementById("color3").value;
            const th = document.getElementById("width_edge").value;
            const sh = document.querySelector('input[name="shape"]:checked').value;
            const kind = document.querySelector('input[name="pattern"]:checked').value;
            const response = generate_svg(i, c1, c2, c3, th, kind, sh);
            document.getElementById("content").innerHTML = response;
        }
        async function run() {
            await init();
            document.getElementById("form_settings").onsubmit = draw;
        }
        run();
    </script>
    <script type="text/javascript" src="ui/pickr.min.js"></script>
</body>

</html>